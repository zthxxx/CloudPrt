webpackJsonp([2],{"+RWh":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("sLrv");i.o(s,"default")&&i.d(e,"default",function(){return s.default})},"+jsG":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("WO9J"),a=i("4/BI");e.default={name:"file-view-header",components:{},props:{file:{type:Object,default:()=>({name:"（加载中 ...）",format:"doc",institute:"-",subject:"-",viewed:0,uploader:{uid:"000"}})}},data:()=>({fileIcon:s.icons}),computed:{upDate(){return this.file&&(0,a.formatDate)(this.file.created)}},watch:{},mounted(){},methods:{back(){this.$router.back()},uploader(){let{uid:t}=this.file.uploader;this.$router.push({name:"person-view",params:{uid:t}})}}}},"/T/c":function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"pagebox",staticClass:"page-box",on:{scroll:t.onScroll}},[i("div",{ref:"pages",staticClass:"page-list"},t._l(t.pagepics,function(e,s){return i("figure",{key:s+e},[i("img",{class:{gray:t.isMono},attrs:{src:e},on:{load:t.onLoadimg}})])})),t._v(" "),i("footer",{ref:"footer",staticClass:"last-tip"},[t.loadEnd&&!t.loading?[t._v("已到达最后一面")]:i("div",{staticClass:"loading"},[i("spinDot",{attrs:{size:36}}),t._v(" "),i("div",{staticClass:"text"},[t._v("拼命加载中...")])],1)],2)])},staticRenderFns:[]};e.a=s},"0bgG":function(t,e){},"19Qr":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i("exGp")),a=d(i("Dd8w")),n=d(i("+RWh")),l=d(i("tIbB")),o=d(i("h8Vs")),r=d(i("xfjd")),c=i("gyMJ");function d(t){return t&&t.__esModule?t:{default:t}}e.default={name:"file-view",components:{affix:n.default,fileViewHeader:o.default,filePageBox:l.default,fileViewSidebar:r.default},props:{},data(){return{fileID:this.$route.params.fileID,file:null,preset:null,page:1}},computed:{fetchPage(){let t=this.preset;return e=>(0,c.getPreview)((0,a.default)({page:e},t))}},watch:{},mounted(){var t=this;return(0,s.default)(function*(){t.file=yield(0,c.getFileInfo)(t.fileID),t.preset={md5:t.fileID,size:"A4",row:1,col:1}})()},methods:{setCurrent(t){this.page=t}}}},"3/KS":function(t,e,i){"use strict";var s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{style:this.placeholderStyle},[e("div",{ref:"fixedNode",class:this.classNames,style:this.affixStyle},[this._t("default")],2)])},staticRenderFns:[]};e.a=s},"4CAS":function(t,e){},"8szQ":function(t,e){},Emuz:function(t,e,i){"use strict";var s=i("+jsG"),a=i.n(s),n=i("FaAc");var l=function(t){i("m8d+")},o=i("VU/8")(a.a,n.a,!1,l,"data-v-c71e9038",null);e.default=o.exports},FaAc:function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("header",[i("div",{staticClass:"left-part"},[i("div",{staticClass:"back",on:{click:t.back}},[i("i",{staticClass:"el-icon-fa-angle-left"}),i("span",[t._v("返回")])]),t._v(" "),i("div",{staticClass:"title"},[i("figure",{staticClass:"file"},[i("img",{attrs:{src:t.fileIcon[t.file.format],alt:"format"}}),t._v(" "),i("figcaption",{staticClass:"description"},[i("div",{staticClass:"name"},[t._v(t._s(t.file.name))]),t._v(" "),i("div",{staticClass:"attribute"},[i("i",{staticClass:"el-icon-fa-bars"}),t._v(" "),i("span",{staticClass:"category"},[t._v(t._s(t.file.institute)+" - "+t._s(t.file.subject))]),t._v(" "),i("span",{staticClass:"reading"},[t._v(t._s(t.file.viewed)+" 次阅读")])])])])])]),t._v(" "),i("div",{staticClass:"right-part"},[t.file.uploader?i("figure",{staticClass:"user",on:{click:t.uploader}},[i("img",{attrs:{src:t.file.uploader.avatar,alt:"avatar"}}),t._v(" "),i("figcaption",{staticClass:"description"},[i("div",{staticClass:"name"},[t._v(t._s(t.file.uploader.nickname))]),t._v(" "),i("div",{staticClass:"time"},[t._v("分享于 "+t._s(t.upDate))])])]):t._e()])])},staticRenderFns:[]};e.a=s},IRpw:function(t,e){},W0Wq:function(t,e,i){"use strict";var s=i("lGhV"),a=i.n(s),n=i("zPf4");var l=function(t){i("IRpw")},o=i("VU/8")(a.a,n.a,!1,l,"data-v-11c9915f",null);e.default=o.exports},ZOVn:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("iu/V");i.o(s,"default")&&i.d(e,"default",function(){return s.default})},h8Vs:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("Emuz");i.o(s,"default")&&i.d(e,"default",function(){return s.default})},"iu/V":function(t,e,i){"use strict";var s=i("19Qr"),a=i.n(s),n=i("jds+");var l=function(t){i("4CAS")},o=i("VU/8")(a.a,n.a,!1,l,"data-v-4fe8e20c",null);e.default=o.exports},jFCP:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i("exGp")),a=l(i("TCwp")),n=i("GKmE");function l(t){return t&&t.__esModule?t:{default:t}}e.default={name:"file-page-box",components:{spinDot:a.default},props:{fetchPage:{type:Function,required:!0},startPage:{type:Number,default:1},total:{type:Number,required:!0,default:0},isMono:{type:Boolean,default:!1}},data(){return{pagepics:[],currentPage:1,loading:!1,onScroll:(0,n.throttle)(this.handleScroll,300)}},computed:{loadEnd(){return this.pagepics.length>=this.total}},watch:{fetchPage:{handler(){this.pagepics=[],this.setPagePic(1)},deep:!0},total(t){this.pagepics.splice(t)}},mounted(){this.setPagePic(1)},methods:{calcCurrent(t,e,i){i=this.loading?i-1:i;let s=(t=t||1)/e*i;return Math.ceil(s)},setPagePic(t){var e=this;return(0,s.default)(function*(){if(e.loading||e.loadEnd)return;e.loading=!0;let{img:i}=yield e.fetchPage(t);e.pagepics.push(i)})()},handleScroll(){let t=this.$refs.pagebox.scrollTop,e=this.$refs.pagebox.clientHeight,i=this.$refs.pages.clientHeight,s=this.pagepics.length,a=i-e,n=this.calcCurrent(t,i,s)||1;if(this.currentPage!==n&&(this.currentPage=n,this.$emit("current",this.currentPage)),t>=a&&!this.loadEnd){let t=s+1;this.setPagePic(t)}},onLoadimg(){this.loading=!1;let t=this.$refs.pagebox.clientHeight;if(this.$refs.pagebox.scrollHeight<=t){let t=this.pagepics.length;this.setPagePic(t+1)}}}}},jQn4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i("Dd8w")),a=l(i("M4fF")),n=i("GKmE");function l(t){return t&&t.__esModule?t:{default:t}}function o(t){return t===window?{top:0,left:0,bottom:0}:t&&t.getBoundingClientRect()}function r(t,e){const i=e?"scrollTop":"scrollLeft";return t===window?t[e?"pageYOffset":"pageXOffset"]:t[i]}function c(t){if(!t)return null;let e={};for(let i in t)e[i]=t[i]+"px";return e}e.default={name:"affix",props:{offsetTop:{type:Number,default:0},offsetBottom:{type:[Number,null],default:null},target:{type:[Window,HTMLElement],default:()=>window},onChange:{type:Function,default:()=>()=>{}}},data(){return{fixedNode:null,placeholderStyle:null,affixStyle:null,events:["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],onUpdatePosition:(0,n.throttle)(this.updatePosition,50)}},computed:{classNames(){return{affix:this.affixStyle}}},watch:{target(t,e){t!==e&&(this.clearEventListeners(e),this.setTargetEventListeners(t),this.updatePosition({}))}},mounted(){this.fixedNode=this.$refs.fixedNode,this.setTargetEventListeners(this.target)},beforeDestroy(){this.clearEventListeners(this.target)},methods:{setAffixStyle(t,e){e=c(e);const{onChange:i,target:s}=this,n=c(this.affixStyle),l=s===window;"scroll"===t.type&&n&&e&&l||a.default.isEqual(e,n)||(this.affixStyle=e,!e^!n&&i(!!e))},setPlaceholderStyle(t){t=c(t);const e=c(this.placeholderStyle);a.default.isEqual(t,e)||(this.placeholderStyle=t)},setTargetEventListeners(t){this.clearEventListeners(t),this.events.forEach(e=>{t.addEventListener(e,this.onUpdatePosition,!1)})},clearEventListeners(t){this.events.forEach(e=>{t.removeEventListener(e,this.onUpdatePosition,!1)})},updatePosition(t){let{offsetTop:e,offsetBottom:i,target:n}=this;const l=r(n,!0),c=function(t,e){const i=t.getBoundingClientRect(),s=o(e),a=r(e,!0),n=r(e,!1),l=window.document.body,c=l.clientTop||0,d=l.clientLeft||0;return{top:i.top-s.top+a-c,left:i.left-s.left+n-d,width:i.width,height:i.height}}(this.$el,n),d={width:this.fixedNode.offsetWidth,height:this.fixedNode.offsetHeight},u=o(n),f=n.innerHeight||n.clientHeight;let p={top:l>c.top-e,bottom:l+f<c.top+d.height+(i||0)};p.top=p.top&&!a.default.isNumber(i),p.bottom=p.bottom&&a.default.isNumber(i);let m={left:u.left+c.left,width:c.width};p.top||p.bottom?(this.setAffixStyle(t,(0,s.default)({},m,p.top?{top:u.top+e}:null,function(t){return t?{bottom:(n===window?0:window.innerHeight-u.bottom)+i}:null}(p.bottom))),this.setPlaceholderStyle({width:c.width,height:d.height})):(this.setAffixStyle(t,null),this.setPlaceholderStyle(null))}}}},"jds+":function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"library"},[i("affix",[i("file-view-header",{attrs:{file:t.file||void 0}})],1),t._v(" "),i("article",{staticClass:"page-content"},[t.preset?i("file-page-box",{attrs:{fetchPage:t.fetchPage,total:t.file.pageCount},on:{current:t.setCurrent}}):t._e()],1),t._v(" "),i("affix",{staticClass:"affix-sidebar",attrs:{"offset-top":70}},[i("file-view-sidebar",{staticClass:"sidebar",attrs:{"affix-top":70,fileID:t.fileID,file:t.file||void 0,page:t.page}})],1)],1)},staticRenderFns:[]};e.a=s},lGhV:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=u(i("exGp")),a=u(i("Dd8w")),n=i("NYxO"),l=i("iltX"),o=i("WO9J"),r=i("4/BI"),c=i("7mV8"),d=i("gyMJ");function u(t){return t&&t.__esModule?t:{default:t}}e.default={name:"file-view-sidebar",components:{},props:{fileID:{type:String,required:!0},file:{type:Object,default:()=>({pageCount:1,printed:0,collected:0,download:{enable:!1}})},page:{type:Number,default:1},affixTop:{type:Number,default:0}},data:()=>({folderIcon:o.collectionFolder_at_0_dot_3x,comment:"",comments:[],limitLen:40,commentExpanded:!1,folders:[],commentStyle:null}),computed:(0,a.default)({},(0,n.mapState)("user",["user"])),watch:{},mounted(){var t=this;return(0,s.default)(function*(){t.setCommentStlye(),t.folders=yield(0,d.containedFolders)(t.fileID),t.comments=yield(0,d.loadFileComment)(t.fileID)})()},methods:{formatTime:r.formatTime,submitComment(){var t=this;return(0,s.default)(function*(){t.user||(yield t[l.POPUP_LOGIN]()),yield(0,d.submitFileComment)({fileID:t.fileID,uid:t.user.uid,content:t.comment}),t.comment="",t.$notify.success({message:"评论发表成功"}),t.comments=yield(0,d.loadFileComment)(t.fileID)})()},viewFolder(t){this.$router.push({name:"folder-view",params:{folderID:t}})},pushFile(t=!0){var e=this;return(0,s.default)(function*(){yield(0,c.pushFileFormLibrary)({name:e.file.name,id:e.fileID,format:e.file.format},t)})()},printFile(){var t=this;return(0,s.default)(function*(){yield t.pushFile(!1),t.$router.push({name:"print"})})()},setCommentStlye(){let t=this.affixTop,{top:e}=this.$el.getBoundingClientRect(),i=window.innerHeight-t||e;this.commentStyle={height:i-10+"px"}},expandComments(){this.commentExpanded=!this.commentExpanded,this.setCommentStlye()},viewPerson(t){this.$router.push({name:"person-view",params:{uid:t}})}}}},"m8d+":function(t,e){},sLrv:function(t,e,i){"use strict";var s=i("jQn4"),a=i.n(s),n=i("3/KS");var l=function(t){i("0bgG")},o=i("VU/8")(a.a,n.a,!1,l,"data-v-50ab0c9a",null);e.default=o.exports},tIbB:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("zUw7");i.o(s,"default")&&i.d(e,"default",function(){return s.default})},xfjd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("W0Wq");i.o(s,"default")&&i.d(e,"default",function(){return s.default})},zPf4:function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("aside",{staticClass:"sidebar"},[i("transition",{attrs:{name:"strut"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.commentExpanded,expression:"!commentExpanded"}],staticClass:"operate"},[i("header",{staticClass:"title"},[t._v("第  "),i("span",[t._v(t._s(t.page)+"/"+t._s(t.file.pageCount))]),t._v("  页")]),t._v(" "),i("div",{staticClass:"controller"},[i("button",{staticClass:"control",on:{click:t.printFile}},[i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-fa-print"})]),t._v(" "),i("div",{staticClass:"description"},[t._v("打印 "+t._s(t.file.printed))])]),t._v(" "),i("button",{staticClass:"control",on:{click:t.pushFile}},[i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-fa-shopping-cart"})]),t._v(" "),i("div",{staticClass:"description"},[t._v("加入打印队列")])]),t._v(" "),i("button",{staticClass:"control"},[i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-fa-bookmark-o"})]),t._v(" "),i("div",{staticClass:"description"},[t._v("收藏 "+t._s(t.file.collected))])]),t._v(" "),t.file.download.enable?i("a",{staticClass:"control",attrs:{href:t.file.download.url,target:"_blank"}},[i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-fa-cloud-download"})]),t._v(" "),i("div",{staticClass:"description"},[t._v("下载")])]):i("button",{staticClass:"control disable"},[i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-fa-cloud-download"})]),t._v(" "),i("div",{staticClass:"description"},[t._v("下载")])])])])]),t._v(" "),i("transition",{attrs:{name:"strut"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.commentExpanded,expression:"!commentExpanded"}],staticClass:"folder"},[i("header",{staticClass:"title"},[t._v("包含该文章的精选集")]),t._v(" "),i("div",{staticClass:"folder-list"},[t._l(t.folders,function(e){return i("figure",{key:e.id,staticClass:"folder-item",on:{click:function(i){t.viewFolder(e.id)}}},[i("img",{attrs:{src:t.folderIcon,alt:"folder"}}),t._v(" "),i("figcaption",{staticClass:"description"},[i("div",{staticClass:"folder-name"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"user",on:{click:function(i){i.stopPropagation(),t.viewPerson(e.uploader.uid)}}},[i("i",{staticClass:"el-icon-fa-user"}),t._v(" "),i("span",{staticClass:"nickname"},[t._v(t._s(e.uploader.nickname))])])])])}),t._v(" "),t.folders.length?t._e():i("span",{staticClass:"empty-tip"},[t._v(" 无 ")])],2)])]),t._v(" "),i("div",{staticClass:"comment",style:t.commentStyle},[i("header",{staticClass:"title",on:{click:t.expandComments}},[i("span",[t._v("文档讨论")]),t._v(" "),t.commentExpanded?i("span",{staticClass:"expand"},[i("i",{staticClass:"el-icon-fa-arrow-down"}),t._v("收起")]):i("span",{staticClass:"expand"},[i("i",{staticClass:"el-icon-fa-arrow-up"}),t._v("展开")])]),t._v(" "),i("el-input",{staticClass:"comment-input",attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},nativeOn:{keyup:function(e){return("button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter"))&&e.ctrlKey?void(t.comment.length&&t.submitComment()):null}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}}),t._v(" "),i("footer",{staticClass:"tips"},[i("span",{staticClass:"lens",class:{"len-warn":t.comment.length>t.limitLen}},[t._v(t._s(t.comment.length)+" / "+t._s(t.limitLen))]),t._v(" "),i("span",[t._v("按 Ctrl + Enter 键发送")])]),t._v(" "),t.comments.length?t._e():i("div",{staticClass:"comment-tip"},[t._v("欢迎发表评论")]),t._v(" "),t._l(t.comments,function(e){return i("figure",{key:e.commentID,staticClass:"comment-item"},[i("img",{attrs:{src:e.avatar,alt:"avatar"}}),t._v(" "),i("figcaption",{staticClass:"comment-content"},[i("span",{staticClass:"discussant"},[t._v(t._s(e.nickname)+":")]),t._v(" "),i("span",{staticClass:"content"},[t._v(t._s(e.content))])]),t._v(" "),i("footer",[i("span",{staticClass:"time"},[t._v(t._s(t.formatTime(e.created)))])])])})],2)],1)},staticRenderFns:[]};e.a=s},zUw7:function(t,e,i){"use strict";var s=i("jFCP"),a=i.n(s),n=i("/T/c");var l=function(t){i("8szQ")},o=i("VU/8")(a.a,n.a,!1,l,"data-v-bfee0056",null);e.default=o.exports}});